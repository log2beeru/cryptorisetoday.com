<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Private Chat</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Arial;background:#0b141a;color:#fff}
#login{height:100vh;display:flex;align-items:center;justify-content:center}
.login{background:#202c33;padding:20px;border-radius:12px;width:90%;max-width:360px}
.login input,.login button{width:100%;padding:12px;border:none;border-radius:8px;font-size:16px}
.login button{background:#00a884;margin-top:10px}

#chat{display:none;height:100vh}
.header{background:#202c33;padding:10px;text-align:center}
.status{font-size:12px;color:#9da3a6}
.messages{height:calc(100vh - 120px);padding:10px;overflow-y:auto}
.bubble{max-width:75%;padding:10px 14px;margin:6px 0;border-radius:12px}
.me{background:#005c4b;margin-left:auto}
.other{background:#202c33}
.typing{font-size:12px;color:#9da3a6;padding-left:10px}

.footer{display:flex;padding:8px;background:#202c33}
.footer input{flex:1;padding:10px;border:none;border-radius:20px}
.footer button{width:44px;border:none;border-radius:50%;background:#00a884;font-size:18px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div class="login">
    <h3>Private Chat</h3>
    <input id="pass" type="password" placeholder="Password">
    <button onclick="join()">Enter</button>
  </div>
</div>

<!-- CHAT -->
<div id="chat">
  <div class="header">
    Private Chat<br>
    <span class="status" id="status">Offline</span>
  </div>

  <div class="messages" id="messages"></div>
  <div class="typing" id="typing"></div>

  <div class="footer">
    <input id="msg" placeholder="Type a message">
    <button onclick="send()">âž¤</button>
  </div>
</div>

<script>
/* ðŸ”§ FIREBASE CONFIG */
const firebaseConfig={
  apiKey:"YOUR_API_KEY",
  authDomain:"YOUR_PROJECT.firebaseapp.com",
  databaseURL:"https://YOUR_PROJECT-default-rtdb.firebaseio.com",
  projectId:"YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* ðŸ” SETTINGS */
const PASSWORD="12345";
const ROOM="private_chat_room";

/* ðŸ‘¤ USER */
const userId="user_"+Math.floor(Math.random()*100000);
const roomRef=db.ref("rooms/"+ROOM);
const usersRef=roomRef.child("users");
const typingRef=roomRef.child("typing");

/* JOIN */
function join(){
  if(pass.value!==PASSWORD){alert("Wrong password");return;}

  usersRef.once("value",snap=>{
    if(snap.numChildren()>=2){
      alert("Only 2 users allowed");
      return;
    }

    login.style.display="none";
    chat.style.display="block";

    usersRef.child(userId).set(true);
    usersRef.child(userId).onDisconnect().remove();

    usersRef.on("value",s=>{
      status.innerText = s.numChildren()===2 ? "Online" : "Waitingâ€¦";
    });

    roomRef.child("messages").limitToLast(100)
      .on("child_added",s=>{
        const m=s.val();
        const d=document.createElement("div");
        d.className="bubble "+(m.user===userId?"me":"other");
        d.textContent=m.text;
        messages.appendChild(d);
        messages.scrollTop=messages.scrollHeight;
      });

    typingRef.on("value",s=>{
      typing.innerText = s.val() && s.val()!==userId ? "Typingâ€¦" : "";
    });
  });
}

/* SEND */
function send(){
  if(!msg.value.trim()) return;

  roomRef.child("messages").push({
    user:userId,
    text:msg.value,
    time:Date.now()
  });

  msg.value="";
  typingRef.set("");
}

/* TYPING */
msg.addEventListener("input",()=>{
  typingRef.set(userId);
  setTimeout(()=>typingRef.set(""),800);
});

/* iOS ENTER FIX */
msg.addEventListener("keydown",e=>{
  if(e.key==="Enter"){e.preventDefault();send();}
});
</script>

</body>
</html>
